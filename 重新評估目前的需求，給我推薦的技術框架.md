# **專案需求規格書：智慧農業水資源管理平台**

## **1\. 專案總覽 (Project Overview)**

### **1.1. 專案名稱**

智慧農業水資源管理平台

### **1.2. 專案目標**

本專案旨在將學術論文《智慧農業水資源管理：電力消耗與用水量最佳化之經驗模式建構》中的核心理論，轉化為一個專業、穩健且符合台灣農民使用習慣的 Web 應用程式。此工具的核心功能是「以電推水」，即透過分析電費帳單數據，科學化地估算農業灌溉用水量。

### **1.3. 目標使用者**

* 台灣農民（特別是像高雄大樹、林園地區的果農）。  
* 農田水利署、農會等農業管理單位人員。

### **1.4. 主要技術棧 (Technology Stack)**

* **主要框架**: **HTML5, CSS3 (使用 Tailwind CSS), JavaScript (ES6+)**  
* **數據處理**: JavaScript 原生功能  
* **數據可視化**: **Chart.js** (或 D3.js, ECharts 等其他 JavaScript 圖表庫)  
* **程式碼品質**: 遵循模組化 (ES Modules) 與關注點分離原則

## **2\. 核心功能需求 (Functional Requirements)**

### **2.1. 農業用水量估算模組**

此為本應用的核心功能，其運算流程經過重新設計。

2.1.1. 輸入介面 (User Inputs)  
使用者介面需提供以下參數的輸入欄位，並明確標示台灣在地化單位：

* **用電種類**: 下拉式選單，選項需從台電 API 動態載入（例如：「表燈非營業用」、「表燈營業用」）。  
* **計費季節**: 選項按鈕或下拉選單，提供「夏月」與「非夏月」選項。  
* **每月電費總金額 (元)**: 數字輸入欄位，此為**取代**原「用電度數」的主要輸入。  
* **作物類型**: 下拉式選單，選項需可從設定檔動態載入。  
* **耕作面積 (分)**: 數字輸入欄位。  
* **進階參數 (預設收合)**:  
  * **抽水馬達馬力 (HP)**: 數字輸入欄位。  
  * **抽水效率 η**: 範圍為 0.0 至 1.0 的滑桿。  
  * **水井深度/水頭 (公尺)**: 數字輸入欄位。

2.1.2. 計算邏輯 (Calculation Logic)  
計算流程分為兩大步驟：  
**步驟一：從電費反推用電度數 (C)**

1. **獲取電價表**: 應用程式啟動時，必須透過 fetch 非同步地從台電 Open Data API (https://service.taipower.com.tw/data/opendata/apply/file/d007008/001.json) 獲取最新的電價表。此數據應被快取以避免重複請求。  
2. **使用者選擇**: 使用者在介面選擇「用電種類」與「計費季節」。  
3. **反推計算**: 系統必須實作一個函數，根據使用者輸入的「電費總金額」以及對應的累進電價級距，反向推算出總用電度數 C (kWh)。此計算需精確處理各級距的費用。  
4. **顯示推算度數**: 計算出的用電度數 C 應顯示在介面上，供使用者參考。

步驟二：計算用水量 (Q and V)  
將步驟一中計算出的用電度數 C，代入以下核心公式進行用水量計算：

1. 計算每分鐘抽水量 Q (單位：噸/分鐘):  
   Q \= (P \* eta) / (0.222 \* H \* 1.2)  
2. 計算每月總用水量 V (單位：噸/每分地):  
   V \= (Q \* 60 \* C) / (2 \* P \* A\_fen)  
   * P: 馬力 (HP)  
   * eta: 抽水效率 (0-1)  
   * H: 水井深度 (公尺)  
   * C: **(來自步驟一反推的) 每月用電度數 (度)**  
   * A\_fen: 耕作面積 (分)

**2.1.3. 輸出顯示 (Results Display)**

* 計算結果 Q 和 V 需以清晰的卡片形式顯示，數值保留至小數點後兩位。  
* 需設置一「超抽警示門檻」（需可於設定檔調整）。當計算出的 V 值超過此門檻時，介面需顯示醒目的紅色警示訊息。

### **2.2. 數據可視化儀表板**

計算結果需以互動式圖表呈現，並採用**頁籤 (Tabs)** 介面設計，避免資訊過載。

* **頁籤一：季節分析**: 顯示當前選擇作物的春、夏、秋、冬四季的預估用水量長條圖。  
* **頁籤二：作物比較**: 將設定檔中所有作物的季節用水量並列於同一張長條圖中，方便使用者比較差異。  
* **頁籤三：年度趨勢**: 根據預設的每月用水因子，繪製預估用水量的年度趨勢折線圖。

### **2.3. 歷史紀錄管理**

* **持久化儲存**: 使用者每次的估算結果可被儲存。紀錄**必須**採用瀏覽器端的**LocalStorage**或**IndexedDB**進行持久化儲存。  
* **介面功能**:  
  * 提供「儲存紀錄」按鈕。  
  * 提供「清除所有紀錄」按鈕，並有二次確認提示。  
  * 歷史紀錄需以**表格 (Table)** 形式清晰展示，包含：作物、**電費金額**、**推算度數**、估算用水量、紀錄時間等欄位。

### **2.4. 在地化與個人化功能**

* **區域定位模擬**: 提供北、中、南區的下拉選單。選擇後，系統需自動帶入該區域的推薦作物與預設水井深度。  
* **介面語言**: 所有介面文字、標籤、提示訊息，皆須使用**繁體中文（台灣慣用語）**。

## **3\. 非功能性需求 (Non-Functional Requirements)**

### **3.1. 架構與程式碼品質**

**專案必須採用現代前端開發架構，嚴格遵循關注點分離原則。**

* **檔案結構**:  
  * index.html: 應用程式的 HTML 骨架。  
  * config.js: 存放所有靜態設定，如作物敏感度、顏色、GPS 數據等。**嚴禁在主邏輯中出現寫死的設定值 (Hardcoding)**。  
  * main.js: 應用程式的主入口，負責初始化與事件監聽綁定。  
  * modules/ (或類似名稱的資料夾):  
    * **power\_calculator.js**: **(新增)** 封裝獲取台電 API 與從電費反推度數的核心邏輯。  
    * water\_calculator.js: 封裝根據度數計算用水量的核心公式函數。  
    * ui.js: 封裝所有 DOM 操作與介面渲染的函數。  
    * chart-manager.js: 封裝所有圖表生成與更新的邏輯。  
    * storage.js: 封裝所有與 LocalStorage 存取相關的操作。  
* **效能 (Performance)**:  
  * **避免不必要的 DOM 操作**: 需有效率地更新介面元素，而非全頁刷新。  
  * **非同步載入**: JavaScript 腳本應採用 defer 屬性，避免阻塞 HTML 渲染。

### **3.2. 使用者介面 (UI/UX)**

* **設計**: 介面需簡潔、現代化，並具備良好的響應式設計，確保在桌面與行動裝置上皆有良好體驗。  
* **互動性**: 所有計算應在使用者調整輸入參數後**即時**反應，無需額外的「計算」按鈕。  
* **使用者引導**: 對於專業術語（如抽水效率）需提供簡短的提示說明。

## **4\. 未來擴充功能規劃 (Future Features)**

應用程式架構需保留擴充性，為以下未來可能的功能預留介面：

* **OCR 電費帳單辨識**: 規劃整合前端 JavaScript OCR 函式庫 (如 Tesseract.js)。  
* **智慧灌溉建議**: 預留整合中央氣象局 API 的可能性，透過 fetch 獲取降雨預報。  
* **資料匯出**: 提供將歷史紀錄匯出為 CSV 檔案的功能，此功能應在前端完成。

## **5\. 部署 (Deployment)**

### **5.1. 部署目標**

本應用程式的最終部署目標為 **Netlify.com**。

### **5.2. 架構要求**

為符合 Netlify 部署要求，整個專案必須是一個**靜態網站 (Static Site)**，不包含任何需要持續運行的後端伺服器。所有計算與互動邏輯皆在使用者瀏覽器端透過 JavaScript 執行。