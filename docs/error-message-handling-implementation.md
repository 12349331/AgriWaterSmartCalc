# éŒ¯èª¤è¨Šæ¯è™•ç†å¯¦ä½œç¸½çµ

**å¯¦ä½œæ—¥æœŸ:** 2025-10-27
**é¢¨éšªç­‰ç´š:** ä½
**ç‹€æ…‹:** âœ… å·²å®Œæˆ

## å¯¦ä½œæ¦‚è¿°

æ ¹æ“šå®‰å…¨å ±å‘Šä¸­çš„ç¬¬ 3 é …ä½åš´é‡æ€§å•é¡Œï¼Œæˆ‘å€‘æ”¹é€²äº†éŒ¯èª¤é‚Šç•Œï¼ˆErrorBoundaryï¼‰å…ƒä»¶çš„éŒ¯èª¤è¨Šæ¯è™•ç†æ©Ÿåˆ¶ï¼Œç¢ºä¿åœ¨æ­£å¼ç’°å¢ƒä¸­ä¸æœƒå‘ä½¿ç”¨è€…é¡¯ç¤ºéæ–¼è©³ç´°çš„æŠ€è¡“è³‡è¨Šå’Œå †ç–Šè¿½è¹¤ï¼ŒåŒæ™‚ä¿ç•™é–‹ç™¼ç’°å¢ƒçš„é™¤éŒ¯èƒ½åŠ›ã€‚

## å•é¡Œèªªæ˜

### åŸå§‹å•é¡Œ

ç•¶æ‡‰ç”¨ç¨‹å¼é‡åˆ°ç„¡æ³•è™•ç†çš„éŒ¯èª¤æ™‚ï¼Œæœƒå‘æ‰€æœ‰ä½¿ç”¨è€…é¡¯ç¤ºï¼š

- å®Œæ•´çš„éŒ¯èª¤è¨Šæ¯
- ç¨‹å¼ç¢¼åŸ·è¡Œè·¯å¾‘ï¼ˆå †ç–Šè¿½è¹¤ï¼‰
- æŠ€è¡“ç´°ç¯€è³‡è¨Š

é€™å¯èƒ½è®“æƒ¡æ„äººå£«ï¼š

- äº†è§£æ‡‰ç”¨ç¨‹å¼çš„å…§éƒ¨çµæ§‹
- ç™¼ç¾æ½›åœ¨çš„å®‰å…¨æ¼æ´
- åˆ©ç”¨æŠ€è¡“è³‡è¨Šé€²è¡Œé‡å°æ€§æ”»æ“Š

### å®‰å…¨é¢¨éšª

é›–ç„¶åš´é‡æ€§ç‚ºã€Œä½ã€ï¼Œä½†æ´©éœ²æŠ€è¡“ç´°ç¯€ä»å¯èƒ½ï¼š

- å¹«åŠ©æ”»æ“Šè€…ç†è§£ç³»çµ±æ¶æ§‹
- æš´éœ²ä½¿ç”¨çš„æ¡†æ¶å’Œç‰ˆæœ¬è³‡è¨Š
- æä¾›æ›´å¤šæ”»æ“Šåˆ‡å…¥é»

## è§£æ±ºæ–¹æ¡ˆ

### æ ¸å¿ƒç­–ç•¥

å¯¦ä½œ**ç’°å¢ƒæ„ŸçŸ¥çš„éŒ¯èª¤é¡¯ç¤ºæ©Ÿåˆ¶**ï¼š

1. **é–‹ç™¼ç’°å¢ƒ** - é¡¯ç¤ºå®Œæ•´éŒ¯èª¤è³‡è¨Šï¼Œæ–¹ä¾¿é™¤éŒ¯
2. **æ­£å¼ç’°å¢ƒ** - åªé¡¯ç¤ºå‹å–„è¨Šæ¯å’ŒéŒ¯èª¤ä»£ç¢¼

### å¯¦ä½œç´°ç¯€

#### 1. ç’°å¢ƒåˆ¤æ–·æ©Ÿåˆ¶

```javascript
const isDevelopment = computed(() => {
  // å¦‚æœæœ‰æ˜ç¢ºæŒ‡å®šï¼Œå‰‡ä½¿ç”¨æŒ‡å®šå€¼ï¼ˆç”¨æ–¼æ¸¬è©¦ï¼‰
  if (props.forceDevelopmentMode !== undefined) {
    return props.forceDevelopmentMode;
  }
  // å¦å‰‡æ ¹æ“šç’°å¢ƒè®Šæ•¸åˆ¤æ–·
  return import.meta.env.DEV || import.meta.env.MODE === "development";
});
```

**ç‰¹é»ï¼š**

- è‡ªå‹•åµæ¸¬ç’°å¢ƒï¼ˆVite çš„ `import.meta.env`ï¼‰
- æ”¯æ´é€é props è¦†å¯«ï¼ˆæ–¹ä¾¿æ¸¬è©¦ï¼‰
- ä½¿ç”¨ computed ç¢ºä¿éŸ¿æ‡‰æ€§

#### 2. éŒ¯èª¤ ID ç”Ÿæˆ

```javascript
function generateErrorId() {
  const timestamp = Date.now().toString(36);
  const randomStr = Math.random().toString(36).substring(2, 7);
  return `ERR-${timestamp}-${randomStr}`.toUpperCase();
}
```

**ç¯„ä¾‹è¼¸å‡ºï¼š** `ERR-M7H2K1N-3F8A9`

**ç”¨é€”ï¼š**

- æ­£å¼ç’°å¢ƒé¡¯ç¤ºçµ¦ä½¿ç”¨è€…
- å¾Œå°æ—¥èªŒè¨˜éŒ„
- æŠ€è¡“æ”¯æ´è¿½è¹¤å•é¡Œ

#### 3. æ¢ä»¶å¼éŒ¯èª¤é¡¯ç¤º

**é–‹ç™¼ç’°å¢ƒï¼š**

```vue
<details v-if="errorDetails && isDevelopment" class="mb-6 text-left">
  <summary>æŸ¥çœ‹éŒ¯èª¤è©³æƒ…ï¼ˆé–‹ç™¼æ¨¡å¼ï¼‰</summary>
  <pre>{{ errorDetails }}</pre>
</details>
```

**æ­£å¼ç’°å¢ƒï¼š**

```vue
<div v-if="!isDevelopment && errorId" class="mb-6 text-sm text-gray-500">
  éŒ¯èª¤ä»£ç¢¼ï¼š{{ errorId }}
</div>
```

#### 4. å®Œæ•´éŒ¯èª¤è¨˜éŒ„

ç„¡è«–ç’°å¢ƒå¦‚ä½•ï¼Œæ‰€æœ‰éŒ¯èª¤éƒ½æœƒè¨˜éŒ„åˆ° loggerï¼š

```javascript
logger.error(`[${currentErrorId}] Error boundary caught:`, {
  error: err,
  message: err.message,
  stack: err.stack,
  info,
  component: instance,
});
```

## ä½¿ç”¨è€…é«”é©—

### é–‹ç™¼ç’°å¢ƒ

ä½¿ç”¨è€…çœ‹åˆ°ï¼š

```
ç³Ÿç³•ï¼ç™¼ç”ŸéŒ¯èª¤
æ‡‰ç”¨ç¨‹å¼é‡åˆ°äº†æ„å¤–éŒ¯èª¤ï¼Œè«‹å˜—è©¦é‡æ–°æ•´ç†é é¢ã€‚

â–¶ æŸ¥çœ‹éŒ¯èª¤è©³æƒ…ï¼ˆé–‹ç™¼æ¨¡å¼ï¼‰
  Error: Cannot read property 'x' of undefined
  Info: render function
  Stack: Error: Cannot read property 'x' of undefined
    at Component.render (...)
    at renderComponentRoot (...)
    ...

[é‡æ–°æ•´ç†é é¢] [æ¸…é™¤è³‡æ–™ä¸¦é‡æ–°æ•´ç†]

è‹¥å•é¡ŒæŒçºŒç™¼ç”Ÿï¼Œè«‹è¯ç¹«æŠ€è¡“æ”¯æ´
```

### æ­£å¼ç’°å¢ƒ

ä½¿ç”¨è€…çœ‹åˆ°ï¼š

```
ç³Ÿç³•ï¼ç™¼ç”ŸéŒ¯èª¤
æ‡‰ç”¨ç¨‹å¼é‡åˆ°äº†æ„å¤–éŒ¯èª¤ï¼Œè«‹å˜—è©¦é‡æ–°æ•´ç†é é¢ã€‚

éŒ¯èª¤ä»£ç¢¼ï¼šERR-M7H2K1N-3F8A9

[é‡æ–°æ•´ç†é é¢] [æ¸…é™¤è³‡æ–™ä¸¦é‡æ–°æ•´ç†]

è‹¥å•é¡ŒæŒçºŒç™¼ç”Ÿï¼Œè«‹è¯ç¹«æŠ€è¡“æ”¯æ´
```

## æ¸¬è©¦è¦†è“‹

### æ¸¬è©¦æª”æ¡ˆ

`tests/unit/components/ErrorBoundary-security.test.js` - 11 å€‹æ¸¬è©¦æ¡ˆä¾‹ï¼Œå…¨éƒ¨é€šé âœ…

### æ¸¬è©¦é …ç›®

**é–‹ç™¼ç’°å¢ƒæ¸¬è©¦ï¼š**

1. âœ… æ‡‰è©²é¡¯ç¤ºè©³ç´°çš„éŒ¯èª¤è¨Šæ¯
2. âœ… æ‡‰è©²é¡¯ç¤ºéŒ¯èª¤å †ç–Šè¿½è¹¤

**æ­£å¼ç’°å¢ƒæ¸¬è©¦ï¼š** 3. âœ… ä¸æ‡‰è©²é¡¯ç¤ºè©³ç´°çš„éŒ¯èª¤è¨Šæ¯ 4. âœ… ä¸æ‡‰è©²é¡¯ç¤ºéŒ¯èª¤å †ç–Šè¿½è¹¤ 5. âœ… æ‡‰è©²é¡¯ç¤ºéŒ¯èª¤ä»£ç¢¼ä¾›æŠ€è¡“æ”¯æ´ä½¿ç”¨ 6. âœ… éŒ¯èª¤ä»£ç¢¼æ‡‰è©²æ˜¯å”¯ä¸€çš„

**é€šç”¨åŠŸèƒ½æ¸¬è©¦ï¼š** 7. âœ… æ‡‰è©²é¡¯ç¤ºå‹å–„çš„éŒ¯èª¤è¨Šæ¯ 8. âœ… æ‡‰è©²æä¾›é‡æ–°æ•´ç†æŒ‰éˆ• 9. âœ… æ‡‰è©²æä¾›æ¸…é™¤è³‡æ–™ä¸¦é‡æ–°æ•´ç†çš„é¸é … 10. âœ… æ‡‰è©²é¡¯ç¤ºæŠ€è¡“æ”¯æ´è¯çµ¡è¨Šæ¯ 11. âœ… ç„¡éŒ¯èª¤æ™‚æ‡‰è©²æ­£å¸¸é¡¯ç¤ºå­å…ƒä»¶

## æŠ€è¡“å„ªå‹¢

### 1. å®‰å…¨æ€§æå‡

- âœ… æ­£å¼ç’°å¢ƒä¸æ´©éœ²æŠ€è¡“ç´°ç¯€
- âœ… ä¸é¡¯ç¤ºç¨‹å¼ç¢¼åŸ·è¡Œè·¯å¾‘
- âœ… ä¿è­·æ‡‰ç”¨ç¨‹å¼å…§éƒ¨çµæ§‹è³‡è¨Š

### 2. é–‹ç™¼é«”é©—

- âœ… é–‹ç™¼ç’°å¢ƒä¿ç•™å®Œæ•´é™¤éŒ¯è³‡è¨Š
- âœ… ä¸å½±éŸ¿é–‹ç™¼æ•ˆç‡
- âœ… æ”¯æ´é€é props æ§åˆ¶ï¼ˆæ¸¬è©¦å‹å–„ï¼‰

### 3. éŒ¯èª¤è¿½è¹¤

- âœ… å”¯ä¸€çš„éŒ¯èª¤ ID
- âœ… å®Œæ•´çš„å¾Œå°æ—¥èªŒè¨˜éŒ„
- âœ… ä¾¿æ–¼æŠ€è¡“æ”¯æ´å®šä½å•é¡Œ

### 4. ä½¿ç”¨è€…é«”é©—

- âœ… å‹å–„çš„éŒ¯èª¤æç¤º
- âœ… æ˜ç¢ºçš„æ“ä½œæŒ‡å¼•
- âœ… æä¾›éŒ¯èª¤ä»£ç¢¼ä¾›å ±å‘Šå•é¡Œ

## éŒ¯èª¤ ID æ ¼å¼

### çµæ§‹

```
ERR-{timestamp}-{random}
```

### ç¯„ä¾‹

```
ERR-M7H2K1N-3F8A9
ERR-M7H2L4P-7B2C1
ERR-M7H2M8T-9D5E3
```

### ç‰¹æ€§

- **å”¯ä¸€æ€§**: æ™‚é–“æˆ³ + éš¨æ©Ÿå­—ä¸²
- **å¯è®€æ€§**: å¤§å¯«å­—æ¯æ•¸å­—çµ„åˆ
- **ç°¡æ½”æ€§**: å›ºå®šå‰ç¶´ `ERR-`
- **è¿½è¹¤æ€§**: å¯å¿«é€Ÿåœ¨æ—¥èªŒä¸­æœå°‹

## å¾ŒçºŒå»ºè­°

### 1. éŒ¯èª¤ç›£æ§

è€ƒæ…®æ•´åˆéŒ¯èª¤ç›£æ§æœå‹™ï¼ˆå¦‚ Sentryï¼‰ï¼š

```javascript
import * as Sentry from "@sentry/vue";

onErrorCaptured((err, instance, info) => {
  // è¨˜éŒ„åˆ°ç›£æ§æœå‹™
  Sentry.captureException(err, {
    contexts: {
      vue: {
        component: instance.$options.name,
        info,
      },
    },
    tags: {
      errorId: currentErrorId,
    },
  });

  // ... ç¾æœ‰é‚è¼¯
});
```

### 2. ä½¿ç”¨è€…å›å ±

å¢åŠ ã€Œå›å ±å•é¡Œã€åŠŸèƒ½ï¼š

```vue
<button v-if="!isDevelopment" class="w-full btn-secondary" @click="reportError">
  å›å ±æ­¤å•é¡Œ
</button>
```

```javascript
function reportError() {
  // é–‹å•Ÿéƒµä»¶å®¢æˆ¶ç«¯æˆ–å›å ±è¡¨å–®
  const subject = encodeURIComponent(`éŒ¯èª¤å›å ± - ${errorId.value}`);
  const body = encodeURIComponent(`
éŒ¯èª¤ä»£ç¢¼: ${errorId.value}
ç™¼ç”Ÿæ™‚é–“: ${new Date().toLocaleString("zh-TW")}
ç€è¦½å™¨: ${navigator.userAgent}

è«‹æè¿°æ‚¨åœ¨åšä»€éº¼æ™‚é‡åˆ°æ­¤éŒ¯èª¤ï¼š

`);
  window.location.href = `mailto:support@example.com?subject=${subject}&body=${body}`;
}
```

### 3. éŒ¯èª¤çµ±è¨ˆ

å»ºç«‹éŒ¯èª¤çµ±è¨ˆå„€è¡¨æ¿ï¼š

- è¿½è¹¤æœ€å¸¸è¦‹çš„éŒ¯èª¤
- åˆ†æéŒ¯èª¤ç™¼ç”Ÿè¶¨å‹¢
- è­˜åˆ¥éœ€è¦å„ªå…ˆä¿®å¾©çš„å•é¡Œ

### 4. é›¢ç·šéŒ¯èª¤å¿«å–

åœ¨ç¶²è·¯ä¸­æ–·æ™‚æš«å­˜éŒ¯èª¤ï¼š

```javascript
function cacheErrorForLater(errorData) {
  const errors = JSON.parse(localStorage.getItem("pending_errors") || "[]");
  errors.push({
    ...errorData,
    timestamp: Date.now(),
  });
  localStorage.setItem("pending_errors", JSON.stringify(errors));
}

// ç¶²è·¯æ¢å¾©æ™‚ä¸Šå‚³
window.addEventListener("online", uploadPendingErrors);
```

## å°æ¯”èªªæ˜

### ä¿®æ”¹å‰ï¼ˆä¸å®‰å…¨ï¼‰

**æ‰€æœ‰ç’°å¢ƒéƒ½é¡¯ç¤ºï¼š**

```
Error: Cannot read property 'x' of undefined
Info: render function
Stack: Error: Cannot read property 'x' of undefined
  at Component.render (webpack-internal:///./src/components/MyComponent.vue:45:15)
  at renderComponentRoot (webpack-internal:///./node_modules/@vue/runtime-core/dist/runtime-core.esm-bundler.js:847:28)
  at Proxy.render (webpack-internal:///./node_modules/@vue/runtime-core/dist/runtime-core.esm-bundler.js:904:16)
  at Object.get (webpack-internal:///./node_modules/@vue/runtime-core/dist/runtime-core.esm-bundler.js:1126:31)
  ...
```

âŒ æ´©éœ²æª”æ¡ˆè·¯å¾‘
âŒ æ´©éœ²æ¡†æ¶å…§éƒ¨çµæ§‹
âŒ æ´©éœ²å…ƒä»¶åç¨±
âŒ æ´©éœ²ç¨‹å¼ç¢¼è¡Œæ•¸

### ä¿®æ”¹å¾Œï¼ˆå®‰å…¨ï¼‰

**æ­£å¼ç’°å¢ƒé¡¯ç¤ºï¼š**

```
ç³Ÿç³•ï¼ç™¼ç”ŸéŒ¯èª¤
æ‡‰ç”¨ç¨‹å¼é‡åˆ°äº†æ„å¤–éŒ¯èª¤ï¼Œè«‹å˜—è©¦é‡æ–°æ•´ç†é é¢ã€‚

éŒ¯èª¤ä»£ç¢¼ï¼šERR-M7H2K1N-3F8A9

[é‡æ–°æ•´ç†é é¢]
```

âœ… å‹å–„çš„è¨Šæ¯
âœ… æ˜ç¢ºçš„æŒ‡å¼•
âœ… è¿½è¹¤ç”¨éŒ¯èª¤ä»£ç¢¼
âœ… ä¸æ´©éœ²æŠ€è¡“ç´°ç¯€

**é–‹ç™¼ç’°å¢ƒä»ä¿ç•™å®Œæ•´è³‡è¨Šä¾›é™¤éŒ¯**

## ç›¸é—œæª”æ¡ˆ

### å¯¦ä½œæª”æ¡ˆ

- `src/components/common/ErrorBoundary.vue` - éŒ¯èª¤é‚Šç•Œå…ƒä»¶

### æ¸¬è©¦æª”æ¡ˆ

- `tests/unit/components/ErrorBoundary-security.test.js` - å®‰å…¨æ€§æ¸¬è©¦

### æ–‡ä»¶

- `docs/security-report.md` - åŸå§‹å®‰å…¨å ±å‘Š
- `docs/error-message-handling-implementation.md` - æœ¬æ–‡ä»¶

## çµè«–

âœ… **éŒ¯èª¤è¨Šæ¯è™•ç†å·²å®Œæˆæ”¹é€²**

- æ­£å¼ç’°å¢ƒä¸å†é¡¯ç¤ºæŠ€è¡“ç´°ç¯€
- é–‹ç™¼ç’°å¢ƒä¿ç•™å®Œæ•´é™¤éŒ¯è³‡è¨Š
- æä¾›å”¯ä¸€çš„éŒ¯èª¤ä»£ç¢¼ä¾›è¿½è¹¤
- 11 å€‹æ¸¬è©¦æ¡ˆä¾‹å…¨éƒ¨é€šé
- æ”¹å–„ä½¿ç”¨è€…é«”é©—å’Œå®‰å…¨æ€§

**é¢¨éšªç­‰ç´š:** ğŸŸ¡ ä½ â†’ ğŸŸ¢ æ¥µä½

æ‡‰ç”¨ç¨‹å¼ç¾åœ¨èƒ½åœ¨ä¿è­·æŠ€è¡“è³‡è¨Šçš„åŒæ™‚ï¼Œä»æä¾›è‰¯å¥½çš„ä½¿ç”¨è€…é«”é©—å’Œé–‹ç™¼é«”é©—ã€‚éŒ¯èª¤ ID æ©Ÿåˆ¶è®“æŠ€è¡“æ”¯æ´èƒ½å¤ æœ‰æ•ˆè¿½è¹¤å’Œè§£æ±ºå•é¡Œï¼Œè€Œä¸éœ€è¦å‘ä½¿ç”¨è€…æš´éœ²æ•æ„Ÿçš„æŠ€è¡“ç´°ç¯€ã€‚
